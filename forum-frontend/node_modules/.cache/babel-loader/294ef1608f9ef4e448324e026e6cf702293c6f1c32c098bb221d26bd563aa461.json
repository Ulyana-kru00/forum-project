{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useRef, useState, useCallback } from 'react';\nexport function useWebSocket(url, {\n  manual = false\n} = {}) {\n  _s();\n  const socketRef = useRef(null);\n  const reconnectTimeoutRef = useRef(null);\n  const [isConnected, setIsConnected] = useState(false);\n  const [connectionStatus, setConnectionStatus] = useState('disconnected');\n  const [messages, setMessages] = useState([]);\n  const [error, setError] = useState(null);\n  const connect = useCallback(() => {\n    if (!url) {\n      console.error(\"WebSocket URL is required.\");\n      return;\n    }\n    if (socketRef.current && (socketRef.current.readyState === WebSocket.OPEN || socketRef.current.readyState === WebSocket.CONNECTING)) {\n      console.warn('WebSocket is already open or connecting.');\n      return;\n    }\n    console.log('Connecting WebSocket to:', url);\n    setConnectionStatus('connecting');\n    socketRef.current = new WebSocket(url);\n    socketRef.current.onopen = () => {\n      console.log('WebSocket connection opened:', url);\n      setIsConnected(true);\n      setConnectionStatus('connected');\n    };\n    socketRef.current.onmessage = event => {\n      console.log('WebSocket message received:', event.data);\n      try {\n        const parsedData = JSON.parse(event.data);\n        setMessages(prevMessages => [...prevMessages, parsedData]);\n      } catch (e) {\n        console.warn('Received non-JSON message:', event.data);\n        setMessages(prevMessages => [...prevMessages, event.data]);\n      }\n    };\n    socketRef.current.onerror = event => {\n      console.error('WebSocket error:', event, `URL: ${url}`);\n      setError('WebSocket encountered an error');\n    };\n    socketRef.current.onclose = event => {\n      console.warn(`WebSocket closed: code=${event.code}, reason=${event.reason}, wasClean=${event.wasClean}`);\n      setIsConnected(false);\n      setConnectionStatus('disconnected');\n\n      // Авто-переподключение при ненормальном закрытии\n      if (event.code === 1006 || !event.wasClean) {\n        console.log('Attempting to reconnect WebSocket in 5 seconds...');\n        reconnectTimeoutRef.current = setTimeout(() => {\n          connect();\n        }, 5000);\n      }\n    };\n  }, [url]);\n  const disconnect = useCallback(() => {\n    if (socketRef.current) {\n      console.log('Disconnecting WebSocket');\n      socketRef.current.close();\n    }\n    if (reconnectTimeoutRef.current) {\n      clearTimeout(reconnectTimeoutRef.current);\n    }\n  }, []);\n  const sendMessage = useCallback(message => {\n    if (socketRef.current && socketRef.current.readyState === WebSocket.OPEN) {\n      const dataToSend = typeof message === 'string' ? message : JSON.stringify(message);\n      socketRef.current.send(dataToSend);\n    } else {\n      var _socketRef$current;\n      console.error('WebSocket is not open. ReadyState:', (_socketRef$current = socketRef.current) === null || _socketRef$current === void 0 ? void 0 : _socketRef$current.readyState);\n    }\n  }, []);\n  useEffect(() => {\n    if (!manual) {\n      connect();\n    }\n    return () => {\n      disconnect();\n    };\n  }, [connect, disconnect, manual]);\n  return {\n    isConnected,\n    connectionStatus,\n    messages,\n    sendMessage,\n    connect,\n    disconnect,\n    error\n  };\n}\n_s(useWebSocket, \"JS/HLWjZsO1qXlcVnf7llBe9lPE=\");\nexport default useWebSocket;","map":{"version":3,"names":["useEffect","useRef","useState","useCallback","useWebSocket","url","manual","_s","socketRef","reconnectTimeoutRef","isConnected","setIsConnected","connectionStatus","setConnectionStatus","messages","setMessages","error","setError","connect","console","current","readyState","WebSocket","OPEN","CONNECTING","warn","log","onopen","onmessage","event","data","parsedData","JSON","parse","prevMessages","e","onerror","onclose","code","reason","wasClean","setTimeout","disconnect","close","clearTimeout","sendMessage","message","dataToSend","stringify","send","_socketRef$current"],"sources":["/Users/darinautalieva/Desktop/GOProject/forum-frontend/src/hooks/useWebSocket.js"],"sourcesContent":["import { useEffect, useRef, useState, useCallback } from 'react';\n\nexport function useWebSocket(url, { manual = false } = {}) {\n  const socketRef = useRef(null);\n  const reconnectTimeoutRef = useRef(null);\n  const [isConnected, setIsConnected] = useState(false);\n  const [connectionStatus, setConnectionStatus] = useState('disconnected');\n  const [messages, setMessages] = useState([]);\n  const [error, setError] = useState(null);\n\n  const connect = useCallback(() => {\n    if (!url) {\n      console.error(\"WebSocket URL is required.\");\n      return;\n    }\n\n    if (socketRef.current && \n      (socketRef.current.readyState === WebSocket.OPEN || socketRef.current.readyState === WebSocket.CONNECTING)) {\n      console.warn('WebSocket is already open or connecting.');\n      return;\n    }\n\n    console.log('Connecting WebSocket to:', url);\n    setConnectionStatus('connecting');\n\n    socketRef.current = new WebSocket(url);\n\n    socketRef.current.onopen = () => {\n      console.log('WebSocket connection opened:', url);\n      setIsConnected(true);\n      setConnectionStatus('connected');\n    };\n\n    socketRef.current.onmessage = (event) => {\n      console.log('WebSocket message received:', event.data);\n\n      try {\n        const parsedData = JSON.parse(event.data);\n        setMessages((prevMessages) => [...prevMessages, parsedData]);\n      } catch (e) {\n        console.warn('Received non-JSON message:', event.data);\n        setMessages((prevMessages) => [...prevMessages, event.data]);\n      }\n    };\n\n    socketRef.current.onerror = (event) => {\n      console.error('WebSocket error:', event, `URL: ${url}`);\n      setError('WebSocket encountered an error');\n    };\n\n    socketRef.current.onclose = (event) => {\n      console.warn(`WebSocket closed: code=${event.code}, reason=${event.reason}, wasClean=${event.wasClean}`);\n      setIsConnected(false);\n      setConnectionStatus('disconnected');\n\n      // Авто-переподключение при ненормальном закрытии\n      if (event.code === 1006 || !event.wasClean) {\n        console.log('Attempting to reconnect WebSocket in 5 seconds...');\n        reconnectTimeoutRef.current = setTimeout(() => {\n          connect();\n        }, 5000);\n      }\n    };\n  }, [url]);\n\n  const disconnect = useCallback(() => {\n    if (socketRef.current) {\n      console.log('Disconnecting WebSocket');\n      socketRef.current.close();\n    }\n    if (reconnectTimeoutRef.current) {\n      clearTimeout(reconnectTimeoutRef.current);\n    }\n  }, []);\n\n  const sendMessage = useCallback((message) => {\n    if (socketRef.current && socketRef.current.readyState === WebSocket.OPEN) {\n      const dataToSend = typeof message === 'string' ? message : JSON.stringify(message);\n      socketRef.current.send(dataToSend);\n    } else {\n      console.error('WebSocket is not open. ReadyState:', socketRef.current?.readyState);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (!manual) {\n      connect();\n    }\n\n    return () => {\n      disconnect();\n    };\n  }, [connect, disconnect, manual]);\n\n  return { isConnected, connectionStatus, messages, sendMessage, connect, disconnect, error };\n}\n\nexport default useWebSocket;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}